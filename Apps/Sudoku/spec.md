# 🧩 ナンプレアプリ仕様書 (Sudoku Single-File App)

**バージョン:** 1.5.0
**更新日:** 2025年12月27日
**ターゲット:** シニア層（視覚過敏・手術後対応）および高パフォーマンス志向ユーザー
**開発手法:** SpriteSystem Hybrid Workflow (Flash & Pro)

---

## 1. プロジェクト概要
本アプリは、SpriteSystemのモデル特性を活かしたハイブリッド開発により、「シニアへの優しさ」と「高度なロジック」を両立させたシングルファイル・アプリケーションです。

### 🛠 開発ハイライト
1. **Phase 1: Architecture (Flash):** 高速なプロトタイプ構築とシニア向け配色（アイボリー基調）の策定。
2. **Phase 2: Logic Design (Pro):** ビット演算による高速エンジンと、人間的な解法アルゴリズムの生成。
3. **Phase 3: Final Polish (Human):** 実機テストに基づくレスポンシブ微調整と、家族向けイースターエッグの統合。

---

## 2. 技術仕様 (Technical Stack)

### アーキテクチャ
* **言語:** HTML5, CSS3, JavaScript (ES2020+)
* **依存ライブラリ:** なし (Vanilla JS 100%)
* **データ保存 (LocalStorage):**
    * **Key:** seniorSudokuApp_v5_local
    * **保存内容:** puzzle, fixed, memos, solution, diffKey, isComplete
    * **除外:** history (Undo用スタック) はメモリ節約のため保存対象外。

### 高速エンジン (Engine)
* **Bitmask 判定:** Int16Array を使用し、行・列・ブロックの状態をビット演算で管理。重複判定を極限まで高速化。
* **安全装置:** 生成処理に 2000ms のタイムアウトを設定。ブラウザのフリーズを完全防止。

---

## 3. UI/UX仕様 (Design System)

### 配色 (Color Palette)
視覚負担を最小限に抑えるため、以下のカラーコードを厳守。

| 用途 | 色名 | コード | 備考 |
| :--- | :--- | :--- | :--- |
| **背景** | Ivory | #F5F5DC | 純白を避け、ハレーションを防止。 |
| **文字** | Dark Navy | #000033 | 高コントラストかつ目に優しい設計。 |
| **エラー** | Red | #D00000 | 誤入力した数字の即時判定表示用。 |
| **メモ** | Gray | #555555 | 確定数字と区別しやすい明度。 |
| **完了時** | Gold | #DAA520 | クリア時の達成感を演出する枠線色。 |

### レイアウト
* **レスポンス:** デバイスの向き（Landscape/Portrait）を検知し、ボタン配置を最適化。
* **操作性:** シニアの誤操作を防ぐため、大きめの数字ボタンと「もどる(Undo)」機能を搭載。

---

## 4. エンジン仕様 (Logic & Difficulty)

難易度は「穴の数」と「解法ロジック」の組み合わせで制御。

| 難易度 | 穴数 | ロジック制限 | 特徴 |
| :--- | :--- | :--- | :--- |
| **⭐ かんたん** | 36 | basic | 候補が1つだけのマス（Naked Single）を埋めるだけで完結。 |
| **⭐⭐ ふつう** | 46 | normal | 列・ブロック単位の推論（Hidden Single）が必要。 |
| **⭐⭐⭐ むずかしい**| 54 | hard | 唯一解であることを保証。高度な定石が必要な場合あり。 |
| **👑 達人** | 62 | hard | ヒント数が極限まで少ないエキスパート仕様。 |

---

## 5. 機能詳細

### スマートメモ機能
* **自動消去:** 数字を確定入力すると、関連する行・列・ブロック内の同じ数字のメモを自動的に削除し、思考の停滞を防ぐ。
* **メモモード:** ボタン一つでメモと確定入力を切り替え。

### 隠し機能 (Easter Egg)
* **誕生日メッセージ:** 2月20日に起動した際、初回のみお祝いダイアログを表示する。
* **実装:** Storage.checkBirthday() にて Date オブジェクトを取得し判定。

---

## 6. 保守ガイド

1. **シングルファイルの維持:** 全てのCSS/JSを index.html 内に保持し、ポータビリティを確保すること。
2. **パフォーマンス:** ソルバーを修正する場合は、必ず Engine オブジェクト内のビット演算ロジックを継承すること。
3. **アクセシビリティ:** 配色を変更する場合は、シニアユーザーの視認性を最優先し、コントラスト比を確認すること。
