※注意: 本仕様書には家族向けの特定の日付（2月20日）に関するロジックが含まれています。外部公開時にはこの項目を削除すること。

# ナンプレアプリ (v1.2.0) 仕様書

**最終更新日:** 2025年12月27日
**バージョン:** 1.2.0 (Logic Engine + PWA Enhanced)
**ターゲット:** シニア層（視覚過敏・手術後）、および高パフォーマンスを求めるユーザー

## 1. プロジェクト概要
本アプリは「世界一目に優しく、論理的に解けるナンプレ」をコンセプトとした、インストール不要のHTML5シングルファイルアプリケーションです。
シニア層のアクセシビリティ（視認性・操作性）を最優先しつつ、内部エンジンには高速かつ「人間的な解き味」を保証するロジックを搭載しています。

### 主な特徴
*   **シングルファイル:** HTML/CSS/JSが1ファイルに完結。オフライン動作可。
*   **PWA完全対応:** Data URIスキームを用いた特殊実装により、サーバー設定なしでAndroid/iOSのホーム画面に追加可能。
*   **シニア特化UI:** 誤操作を防ぐレイアウト、目に刺さらない配色、震えに対応した大きなボタン。

---

## 2. デザイン・UI仕様 (Design System)

### 配色パレット (厳守)
白内障や光過敏に配慮し、純白（`#FFFFFF`）と漆黒（`#000000`）のコントラストを避け、以下のアイボリー基調を採用しています。

| 要素 | カラーコード | 備考 |
| :--- | :--- | :--- |
| **背景色** | `#F5F5DC` (Beige) | アプリ全体の背景。目に優しいアイボリー。 |
| **文字色** | `#000033` (Dark Navy) | 視認性の高い濃紺。 |
| **盤面背景** | `#FDFDF0` | マス目の背景。 |
| **選択セル** | `#FFFFA0` (Pale Yellow) | 選択中のマス。 |
| **十字ハイライト** | `#EBEBE0` (Pale Gray) | **v1.2.0新機能**。選択セルの縦横列を薄く強調。 |
| **エラー文字** | `#D00000` (Red) | **v1.2.0新機能**。誤入力即時判定用の赤字。 |

### レイアウト・レスポンシブ挙動
`CSS Grid` を使用し、端末の向きによって構造を動的に変更します。

1.  **縦画面 (Portrait): サンドイッチ配置**
    *   上から `[機能ボタン]` -> `[盤面]` -> `[数字キー]` の順。
    *   指が画面下部に集中するため、片手操作が容易。
2.  **横画面 (Landscape): 左右分割 + スクロール**
    *   左：`[盤面]` (最大化)、右：`[操作パネル]`。
    *   **対策:** 画面の縦幅が狭い機種での「上部見切れ」を防ぐため、`overflow-y: auto` と `align-content: start` を適用。
    *   **ボタン:** ヘッダーが消える代わりに、サイドパネル内に「使い方」「新規」ボタンが出現する（`.landscape-only` クラス制御）。

---

## 3. ゲームロジック仕様 (Engine Specs)

### 生成アルゴリズム
従来の「穴あけ法」に加え、**v1.2.0より「人間的思考シミュレーター」**を導入しました。

1.  **ベース作成:** `Bitmask` + `Backtracking` で完全な正解盤面を作成。
2.  **穴あけと検証:** ランダムに穴を開けた後、以下の2段階チェックを行う。
    *   **Check 1 (唯一解):** 解が1つしか存在しないことを確認。
    *   **Check 2 (論理品質):** 難易度設定に応じ、人間的なロジックで解けるか検証。

### 難易度定義 (Logic Levels)
単なる「空きマスの数」ではなく、「解法テクニック」で定義されています。

| 難易度 | 空きマス目安 | 必須ロジック (Logic Check) | 特徴 |
| :--- | :--- | :--- | :--- |
| **かんたん** | 36個 | **Naked Single** (裸のシングル) | 「このマスに入る数字はこれしかない」だけで最後まで解ける。仮置き不要。 |
| **ふつう** | 46個 | **Hidden Single** (隠れたシングル) | 「この列で1が入れる場所はここだけ」という推論が必要。 |
| **むずかしい** | 54個 | Logic Checkなし | 高度な定石や、広い視野が必要。 |
| **達人** | 62個 | Logic Checkなし | ヒント数が極限まで少ない。 |

### タイムアウト安全装置
生成処理が無限ループや長時間フリーズを起こさないよう、`2000ms` を超えた場合は生成を打ち切り、その時点での盤面を採用、または再試行します。

---

## 4. 機能仕様 (Functional Specs)

### リアルタイム判定 (Real-time Validation)
*   **仕様:** 数字を入力した瞬間、正解データ(`solution`)と照合する。
*   **挙動:** 間違いであれば、即座に文字色を赤(`error-text`)にする。
*   **意図:** シニア層は「後でまとめて直す」ことがストレスになるため、その場で気づかせる仕様。

### クロスハイライト (Cross Highlight)
*   **仕様:** 選択したマスの「行」と「列」を薄く色付けする。
*   **変更点:** 以前あった「同じ数字のハイライト」は**廃止**（ヒント過多防止のため）。

### PWA / Android対応
*   **実装:** シングルファイルの制約を守るため、外部ファイルを一切読み込まない。
*   **アイコン:** SVGをBase64エンコードし、`<link rel="icon">` 等に直接記述。
*   **Manifest:** JSONをBase64エンコードし、Data URIとして埋め込み。
    *   これにより、Android Chromeの「ホーム画面に追加」でネイティブアプリのように振る舞う。

### 隠し機能 (Easter Egg)
*   **誕生日祝い:** 2月20日にアプリを起動すると、初回のみお祝いダイアログが表示される。

---

## 5. モジュール構造 (Code Architecture)

コードは単一ファイル内で厳密にモジュール分割されています。

1.  **`CONFIG`**: バージョン、難易度設定、タイムアウト値。
2.  **`Engine`**: 数独の生成・解答・ロジック判定を行うコア。ビット演算使用。
3.  **`Storage`**: `localStorage` への保存・読み込み。
4.  **`UI`**: DOM操作、描画、ダイアログ表示。CSSクラスの付け替えのみで制御。
5.  **`App`**: アプリの状態管理（State）、イベントハンドリング、ゲーム進行制御。

## 6. 保守・拡張時の注意点

*   **HTMLファイル単体での運用:** 画像ファイルやCSSファイルを分離しないでください（高齢者がファイルを紛失するリスクを防ぐため）。
*   **CSS Gridの維持:** レイアウト変更時は `grid-template-areas` を編集すること。HTML構造を不用意に変えるとレスポンシブが崩れます。

*   **アイコン変更:** アイコンを変更する場合は、SVGをBase64化して `head` 内の該当箇所を置換してください。
